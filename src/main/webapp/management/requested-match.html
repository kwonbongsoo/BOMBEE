<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="../font-awesome/css/font-awesome.min.css">
<link rel="stylesheet"
	href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
<link rel='stylesheet'
	href='../node_modules/jquery-ui-dist/jquery-ui.min.css'>
<link rel='stylesheet' href='../css/bombee.css'>
<link rel='stylesheet' href='../css/requested-match.css'>
<script src="../node_modules/jquery/dist/jquery.min.js"></script>
<script src="../node_modules/jquery-ui-dist/jquery-ui.min.js"></script>
<script src="../node_modules/handlebars/dist/handlebars.min.js"></script>
<title>Requested Match</title>
</head>

<body>
	<div class='requested-match-container'>
		<div class='header'></div>
		<div class='request-container'></div>
	</div>


	<script id="request-template" type="text/x-handlebars-template">
		{{#this}}
		<div class='request-list'>
			<div class='fa fa-smile-o smile-size'></div>
			<div class='request-info'>
				<span class='user-name'>{{mname}}</span>
				<span class='request-date'>{{pm}} {{time}}</span>
				<span class='request-content'>{{title}}</span>
				<span class='wish-date'>{{sdt}} {{wishtime}}시</span>
				<span class='wish-period'>{{period}}개월</span>
			</div>
			<div class='btn-form'>
				<div class='accept btn' data-trano='{{trano}}'>수락</div>
				<div class='refuse btn' data-trano='{{trano}}'>거절</div>
			</div>
		</div>
		{{/this}}
</script>
</body>
<script>
  $(function() {
    $('.header').load('../menu/new.html')
  })

  var json = '/auth/userinfo.json'
  var no = -1
  var trano = -1
  getData(json, no)

  function getData(json, no) {
    $.getJSON(json, {
      'no' : no
    }, function(result) {
      if (json == '/auth/userinfo.json') {
        if (result.data.membertype == 2)
          no = result.data.no
        else 
          location.href = '../auth/login.html'
        console.log()
        getData('/friend/addList.json', no)
      } else if (json == '/friend/addList.json') {
        console.log(result)
        var templateFn = Handlebars.compile($('#request-template').text())
  			var generatedHTML = templateFn(result.data) // 템플릿 함수에 데이터를 넣고 HTML을 생성한다.
  			var container = $('.request-container')
  			container.html("")
  			container.html(generatedHTML) 
        
  			btnConnect()
      } else if (json == '/friend/friendDelete.json') {
        //거절 버튼을 눌렀을대 실행하면 되는 요청
        console.log(result)
      } else if (json == 'friend/friendUpdate.json') {no
        // 수락 버튼을 눌렀을 때 실행하면 되는데 sdt를 오늘 날짜로 다시 update해줘야함
        // mno 도 날려야함 no는 tno
        console.log(result)
      }
    })
  }
  function btnConnect() {
    $('.refuse').click(function() {
      trano = $(this).attr('data-trano')
      console.log(trano)
      getData('/friend/friendDelete.json', trano)
      //연결되면 하면됨
    })
    $('.accept').click(function() {
      // 수락하면 업데이트 해야함
    })
  }
</script>

</html>
