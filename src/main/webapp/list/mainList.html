<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" />
  <link rel="stylesheet" href="../font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link rel='stylesheet' href='../css/bombee.css'>
  <link rel='stylesheet' href='../css/mainList.css'>
  <link rel="stylesheet" href="../node_modules/swiper/dist/css/swiper.min.css">
  <script src='../node_modules/jquery/dist/jquery.min.js'></script>
  <script src="../node_modules/jquery-ui-dist/jquery-ui.js"></script>
  <script src="../node_modules/handlebars/dist/handlebars.min.js"></script>
  <script>
    $(document).ready(function() {
      $('.header').load('../menu/new.html')
    })
  </script>
 
</head>

<body>
  <div class='allList-container'>
    <div class='header'></div>
    <!-- Swiper -->
    <div class="indexUp swiper-container">
      <div class="swiper-wrapper">
        <div class="swiper-slide"><img src='../image/main_1.jpg'></div>
        <div class="swiper-slide"><img src='../image/main_2.jpg'></div>
        <div class="swiper-slide"><img src='../image/main_3.jpg'></div>
        <div class="swiper-slide"><img src='../image/main_4.jpg'></div>
        <div class="swiper-slide"><img src='../image/main_5.jpg'></div>
        <div class="swiper-slide"><img src='../image/main_6.jpg'></div>
        <div class="swiper-slide"><img src='../image/main_7.jpg'></div>
        <div class="swiper-slide"><img src='../image/main_8.jpg'></div>
        <div class="swiper-slide"><img src='../image/main_9.jpg'></div>
        <div class="swiper-slide"><img src='../image/main_10.jpg'></div>
      </div>
    </div>
    <div class='indexUp wrap'>
      <div class="scrollBlind">
        <div class="btn-group outer" data-toggle="buttons">
          <label class="btn" role="button">
            <input id ='searchMapGo'type="radio" name="options"  required="required">
            <i class="fa fa-map-marker pin" aria-hidden="true"></i>
          </label>
          <label class="btn click margin-minus" role="button" >
            <input  type="radio" name="options" value="0" id='hot-cos'>인기코스
          </label>
          <label class="btn margin-minus" role="button">
            <input  type="radio" name="options" value="1" id='health' >헬스
          </label>
          <label class="btn margin-minus" role="button">
            <input type="radio" name="options" value="3" id='yoga'>요가
          </label>
          <label class="btn margin-minus" role="button" >
            <input  type="radio" name="options" value="4" id='pilates'>필라테스
          </label>
          <label class="btn margin-minus" role="button" >
            <input  type="radio" name="options" value="2" id='spinning'>스피닝
          </label>
        </div>
        <!-- btn-group -->
      </div>
      <!--scrollBlind  -->
    </div>
    <!--indexUp wrap  -->
    <div id='promotion-list-container'>
      <div id='promotion-in'>
        <div class='left-promotion main-promotion-heightz'>
          <img src='../image/first.jpg'>
        </div>
      </div>
      
    </div>
    <!-- promotion-list-container -->

  </div>
  <!-- allList-container -->
  <!-- Swiper JS -->
  <script src="../node_modules/swiper/dist/js/swiper.min.js"></script>
  <!-- Initialize Swiper -->
  <script id='health-template' type="text/x-handlebars-template">
    {{#each list}} {{#isIndex @index this}}
    <div class='right-promotion main-promotion-height promotion'>
      {{else}}
      <div class='left-promotion main-promotion-height promotion'>
        {{/isIndex}}
        <div class='img'>
             <img value='{{pno}}' title='{{spono}}' class='img-{{pno}}'
         {{#if @last}}
           id='last-promotion'
         {{else}}
         {{/if}}>
        </div>
        <div class='span'>
          <span>{{title}}</span>
        </div>
      </div>
      {{/each}}
  </script>
  <script>
    var json = '/promotion/hot-firstList.json'
    var category;
    var count = 0
    var lastNo = 1000
    var offset = 0
    var no = 0
    var type = $('.click').children().attr('value')
    var titleImage = []
    var imgTag = []
    var width = 0
    if($(window)[0].innerWidth > 375 && $(window)[0].innerWidth <= 414) 
            width = '_210.png'
          else if($(window)[0].innerWidth > 320 && $(window)[0].innerWidth <= 375) 
            width = '_190.png'
          else if($(window)[0].innerWidth <= 320)
            width = '_170.png'
    console.log(width)
    var swiper = new Swiper('.swiper-container', {
      loop: true,
      autoplay: 2000,
      autoplayDisableOnInteraction: false
    });
    $(document).ready(function() {
    	$(window).scroll(function () {
    		if($(window).scrollTop() == $(document).height() - $(window).height()) {
    			lastNo = $('#last-promotion').attr('value') -1
    			$('#last-promotion').attr('id', '')
    			json = '/promotion/hot-nextList.json';
    			console.log(type)
    			console.log(lastNo)
    		         if(type != 0)
    		        	 json = '/promotion/health-nextList.json'
    		          getData(json, type) 
    		}
    	})

    })
    
    $('.btn').click(()=> {
    	$('.btn').css('color', 'black');
    	$('.btn-test').css('color', 'white')
    })

    Handlebars.registerHelper('isIndex', function(index, promotion ,options) {
    	imgTag.push('img-'+promotion.pno)
    	titleImage.push(promotion.titlePic)
      if (index % 2 == 0) {
    	  console.log(options.fn(this))
        return options.fn(this);
      } else {
    	  console.log(options.inverse(this))
        return options.inverse(this);
      }
    });
    
    
    getData(json, 0);

    function getData(json, typeNo) {
    	if ( json == '/promotion/hot-nextList.json' || 
    			json == '/promotion/health-nextList.json') {
    			
    			console.log(lastNo)
    			}
    	else 
      	$('.promotion').remove()
      	if (lastNo > 1) {
      		$.getJSON(json, {
      			'lastNo' : lastNo,
      			'typeNo': typeNo
      			}, function(result) {
    	  console.log(result.data)
        // 템플릿 소스를 가지고 템플릿을 처리할 함수를 얻는다.
        var templateFn = Handlebars.compile($('#health-template').text())
        var generatedHTML = templateFn(result.data) // 템플릿 함수에 데이터를 넣고 HTML을 생성한다.
        var container = $('#promotion-in')
        var html = container.html()
        container.html(html + generatedHTML) // 새 tr 태그들로 설정한다.
        console.log(imgTag)
        console.log(titleImage)
        btnClick()
        for (var i = 0; i < imgTag.length; i++) {
          $('.'+imgTag[i]).attr('src', '../upload/'+titleImage[i]+width)
          console.log(imgTag[i])
          console.log(titleImage[i])
        }
        imgTag= []
        titleImage = []
      		})
     	}
     lastNo = 100
    }

    function borderBottom(category) {
      $('.btn').removeClass('click')
      $(category).parent().addClass('click')
      type = $('.click').children().prop('value')
      
    }
    $('#searchMapGo').click(function () {
    	location.href = '../list/searchList.html'
    })
    
    $('#hot-cos').click(() => {
      category = '#hot-cos'
      borderBottom(category)
      json = '/promotion/hot-firstList.json'
      getData(json, 0)
    })

    $('#pilates').click(() => {
      category = '#pilates'
      borderBottom(category)
      json = '/promotion/health-firstList.json'
      getData(json, 4)
      
    })

    $('#yoga').click(() => {
      category = '#yoga'
      borderBottom(category)
      json = '/promotion/health-firstList.json'
      getData(json, 3)
    })

    $('#health').click(() => {
      category = '#health'
      borderBottom(category)
      json = '/promotion/health-firstList.json'
      getData(json, 1)
      
    })
    $('#spinning').click(() => {
      category = '#spinning'
      borderBottom(category)
      json = '/promotion/health-firstList.json'
      getData(json, 2)
    })
    function btnClick() {
    	$('.img img').click(function() {
    		
    		no = $(this).attr('value')
    		location.href = '../promotion/promotionDetail.html?no='+no
    		//no='+no
    	      //$.getJSON()
    	    })
    }
  </script>
</body>
</html>
