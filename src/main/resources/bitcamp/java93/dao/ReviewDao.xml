<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- Mybatis에서 DAO 구현체를 자동으로 만들 때는,
     SQL 맵퍼 파일의 namespace 값이 DAO 인터페이스와 같아야 한다. -->
<mapper namespace="bitcamp.java93.dao.ReviewDao">
  <!-- DB 컬럼과 자바 객체의 프로퍼티를 연결하는 정보 -->
  <resultMap type="review" id="reviewMap">
    <id column="reviewno" property="reviewno"/>
    <result column="review" property="review"/>
    <result column="score" property="score"/>
    <result column="name" property="name"/>
    <result column="mno" property="mno"/>
    <result column="trano" property="trano"/>
    <result column="tno" property="tno"/>
    <result column="writerev" property="writerev"/>
  
  </resultMap>


<insert id="insert" parameterType="review" 
          useGeneratedKeys="true" keyColumn="reviewno" keyProperty="reviewno">
    insert into tcher_review(score, trano, review) 
    values(#{score}, #{trano}, #{review})
  </insert>
  


  <select id="detail" resultMap="reviewMap" parameterType="int">
   select tr.score, tr.review, m.name from 
   tcher_review tr left join tcher_trainer tt on tr.trano=tt.trano
   inner join memb m on tt.mno=m.mno 
    where tt.tno=#{tno}
  </select>
    
    <select id="detail2" resultMap="reviewMap" parameterType="review">
       select * 
   tcher_review tr left join tcher_trainer tt on tr.trano=tt.trano 
    where tt.tno=#{tno}
  </select>
  
  <select id="detail3" resultMap="reviewMap" parameterType="review">
       select AVG(tr.score)
   tcher_review tr left join tcher_trainer tt on tr.trano=tt.trano 
    where tt.tno=#{tno}
  </select><!-- 평균구하는거 -->
  
  <update id="update" parameterType="int">
   update tcher_trainer set
    writerev=true
    where trano=#{no};
  </update>


</mapper>
